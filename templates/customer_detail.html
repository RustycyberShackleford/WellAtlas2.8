<!doctype html>
<html>
<head><title>{{ header_title }}</title><link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"></head>
<body>
<header><h1 id="appTitle">{{ header_title }}</h1>
<nav><a href="{{ url_for('customers_index') }}">← Customers</a> | <a href="{{ url_for('index') }}">Map</a></nav>
</header>
<main class="wrap">
<section class="card">
  <h2>{{ customer['name'] }}</h2>
  <p><strong>Address:</strong> {{ customer['address'] or '—' }}</p>
  <p><strong>Phone:</strong> {{ customer['phone'] or '—' }}</p>
  <p><strong>Email:</strong> {{ customer['email'] or '—' }}</p>
  <p><strong>Notes:</strong> {{ customer['notes'] or '—' }}</p>
  <form method="post" enctype="multipart/form-data" action="{{ url_for('customer_upload', cid=customer['id']) }}">
    <input type="file" name="photo" accept="image/*" required>
    <input type="text" name="caption" placeholder="Caption (optional)">
    <button>Add Photo</button>
  </form>
  
  <p>
    <button id="shareCustomerBtn" type="button">Create Share Link</button>
    <input id="shareCustomerOut" style="width:100%;margin-top:6px" placeholder="Share link will appear here..." readonly>
  </p>
  <script>
    document.getElementById('shareCustomerBtn').addEventListener('click', async () => {
      const resp = await fetch('{{ url_for("create_customer_share", cid=customer["id"]) }}', {method:'POST'});
      const data = await resp.json();
      document.getElementById('shareCustomerOut').value = data.url;
      try { await navigator.clipboard.writeText(data.url); } catch(e) {}
    });
  </script>

  <div class="photos">
    {% for p in photos %}<figure><img src="{{ url_for('uploaded_file', filename=p['filename']) }}"><figcaption>{{ p['caption'] or '' }}</figcaption></figure>{% else %}<p>No photos.</p>{% endfor %}
  </div>
</section>
<section class="card">
  <h3>Sites for {{ customer['name'] }}</h3>
  <ul class="jobs">
    {% for s in sites %}<li><a href="{{ url_for('site_detail', site_id=s['id']) }}">{{ s['name'] }}</a></li>{% else %}<li>No active sites.</li>{% endfor %}
  </ul>
</section>
</main>
</body></html>
